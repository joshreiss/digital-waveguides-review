<h2>KS with filter and controls</h2>
<br>Uses pitch and smoothing factor<br>
<input type='button' value='play' id='Play'><br>
<input type="range" id="pitch" oninput="pitchValue.value = pitch.value" min="0.1" max="1000" step="0.1" value="130">
<output id="pitchValue">130</output> Pitch<br>
<input type="range" id="stringDamping" oninput="stringDampingValue.value = stringDamping.value" min="0.1" max="0.7" step="0.1" value="0.5">
<output id="stringDampingValue">0.5</output> String damping<br>
<script>
  var context = new AudioContext
  context.audioWorklet.addModule('KSWorklets.js').then(() => {
    let Noise = new AudioWorkletNode(context,'noise-generator'),
    NoiseGain = new GainNode(context,{gain:0}),
    output = new GainNode(context),
    feedbackDelay= new AudioWorkletNode(context,'feedbackDelay-processor',
      {parameterData:{pitch:130,gain:0.96,smoothingFactor:stringDamping.value}
    })
    Noise.connect(NoiseGain)
    NoiseGain.connect(output)
    NoiseGain.connect(feedbackDelay)
    feedbackDelay.connect(output)
    output.connect(context.destination)
    Play.onclick = function() {
      context.resume()
      console.log(pitch.value, stringDamping.value)
      feedbackDelay.parameters.get('pitch').value = pitch.value
      feedbackDelay.parameters.get('smoothingFactor').value = stringDamping.value
      let now = context.currentTime
      NoiseGain.gain.setValueAtTime(0.125, now)
      NoiseGain.gain.setValueAtTime(0, now+0.009)
    }
  })
</script>
