<b>Digital Waveguides Review - Code examples</b>

<ul>
    <li><a href="01_CombFilter/combFilter.html">Introducing Delay Lines- the comb filter</a></li>
    <li><a href="02_FeedbackDelay/feedbackDelay.html">Feedback delay</a> based on routing the output of the delay node back to the input</li>
    <li><a href="03_KarplusStrongV1/KarplusStrong.html">Simplified Karplus Strong v1</a></li>
    <li><a href="04_KarplusStrongV2/KarplusStrongV2.html">Simplified Karplus Strong v2- An audio worklet version, implemented without the limitations on the pitch range that come from the DelayNode in a feedback loop</li>
</a></li>
    <li><a href="05_IdealPluckedString/index.html">Ideal plucked string</a></li>
    <li><a href="06_NegativeFeedback/index.html">Negative feedback</a></li>
    <li><a href="07_DWfilters/DWfilters.html">Digital Waveguide Filters</a></li>
    <li><a href="08_Nonlinearities/Nonlinearities.html">Nonlinearities in the feedback filter</a></li>
    <li>Removing DC offset</li>
    <li><a href="10_Pitch control/index.html">Controlling the Pitch</a>/li>
    <li>Note transitions</li>
    <li>Basic waveguide implementations</li>
    <li>Fractional delay</li>
    <li>Animal vocalisation example</li>
    <li>Flute example</li>
    <li>Reverb example</li>
</ul>

Some code examples correspond to examples from Chapters 10 and 19 of the book 'Working with the Web Audio API'.

Feel free to contact me at joshua.reiss@qmul.ac.uk
    
<h2>Removing DC offset</h2>
Suppose a nonlinearity with too much slope at the origin is applied. That is, |NL'(0)|>1, assuming NL includes the feedback.
So a slight positive or negative average offset can get amplified inside the loop until the signal gets squashed. 
This can result in the output disappearing at high feedback values. To avoid this, a one-pole 30Hz high pass filter is used in the feedback loop.
  
<h2> Note Transitions</h2>
The model above has staccato notes and does not implement proper note transitions. If we attempt to change the length of the delay line while a note is playing, the output does not remotely resemble a legato sound (at best, we can change it slowly and obtain a slide whistle sound). In the legato transition of a real flute, a tone hole is opened or closed, and the bore effectively has a Y-junction during the transition. 
This can be better modeled by cross-fading between two fixed-length delay lines in the loop. 
Two delay lines will generally suffice for any monophonic sequence of notes, since one of them can generate sound while the other  changes length.
  To Do!<br>
A waveguide model playing controllable legato notes. Move the "note" slider to control the notes.

<h2>Basic waveguide implementations</h2>
    To do!<br>
    The top diagram above directly matches the physical model. 
    We often use the simplified form in the second diagram, obtained by changing the point at which the delay loop is sampled, then combining delays inside the loop.<br>
    More generally, the input and output points as well as the order of elements inside the delay loop can often be modified with no audible difference, 
    even if the model is not exactly equivalent. The third diagram is intended for low latency implementation.
    
<h2>Fractional delay</h2>
    Digital delay lines are made of discrete samples, but they often need to be read at arbitrary times between samples. 
    A common approach is to use polynomial interpolation, where a polynomial is found which fits several nearby samples. Second order interpolation is often sufficient for many musical purposes.
  
<h2>Animal vocalisation example</h2>
Suppose that the looped delay line provides an infinite number of harmonics of its base frequency, some having more weight than others. 
Without any filters, the weights of harmonics are based on their harmonic distance: the simplest fractions, such as the fundamental, are the heaviest. This weight determines which harmonics are more likely to resonate, with the lighter ones generally being softer or absent (this is probabilistic when the exciter is based on noise). By adding filters into the loop, we shape the spectrum of those weights. When crossfading multiple delays in the loop, we intersect the spectra of their weighted harmonics.
However, complex filtering in the loop means the final pitch of the model will be much harder to control. 
One practical solution is to play along with it, since these pitch fluctuations can be satisfyingly organic, especially when the context is not musical.<br>
This approach is used here to create animal vocalisations. There are two parallel bandpass filters in the loop, one of which has three times the frequency of the other.
To Do!<br>
What animal is this?

<h2>Flute example</h2>
The following example simulates the higher registers of a flute by means of a bandpass crossfaded with a lowpass in the loop, making the pitch harder to predict. Despite this, an attempt is made to keep the final pitch in tune with the original intended pitch. We use the same formula introduced in the above section Controlling the Pitch, with one modification: fcfc is now the sum of the frequencies of both filters.
To Do!<br>
Flute model with exaggerated higher registers.
